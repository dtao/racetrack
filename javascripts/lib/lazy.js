!function(context){function Sequence(){}function MappedSequence(e,t){this.parent=e,this.mapFn=t}function CachingSequence(){}function FilteredSequence(e,t){this.parent=e,this.filterFn=t}function ConcatenatedSequence(e,t){this.parent=e,this.arrays=t}function SimpleIntersectionSequence(e,t){this.parent=e,this.array=t,this.each=getEachForIntersection(t)}function getEachForIntersection(e){return e.length<40?SimpleIntersectionSequence.prototype.eachArrayCache:SimpleIntersectionSequence.prototype.eachMemoizerCache}function SimpleZippedSequence(e,t){this.parent=e,this.array=t}function Iterator(e){this.sequence=e,this.index=-1}function FilteringIterator(e,t){this.iterator=e.getIterator(),this.filterFn=t}function CharIterator(e){this.source=e,this.index=-1}function StringMatchIterator(source,pattern){this.source=source,this.pattern=eval(""+pattern+(pattern.global?"":"g"))}function SplitWithRegExpIterator(source,pattern){this.source=source,this.pattern=eval(""+pattern+(pattern.global?"":"g"))}function SplitWithStringIterator(e,t){this.source=e,this.delimiter=t}function UniqueMemoizer(e){this.iterator=e,this.set=new Set,this.memo=[],this.currentValue=void 0}function ArrayLikeSequence(){}function IndexedMappedSequence(e,t){this.parent=e,this.mapFn=t}function IndexedFilteredSequence(e,t){this.parent=e,this.filterFn=t}function IndexedReversedSequence(e){this.parent=e}function IndexedTakeSequence(e,t){this.parent=e,this.count=t}function IndexedDropSequence(e,t){this.parent=e,this.count="number"==typeof t?t:1}function IndexedConcatenatedSequence(e,t){this.parent=e,this.other=t}function IndexedUniqueSequence(e,t){this.parent=e,this.each=getEachForParent(e),this.keyFn=t}function getEachForParent(e){return e.length()<100?IndexedUniqueSequence.prototype.eachArrayCache:UniqueSequence.prototype.each}function ArrayWrapper(e){this.source=e}function MappedArrayWrapper(e,t){this.source=e,this.mapFn=t}function FilteredArrayWrapper(e,t){this.parent=e,this.filterFn=t}function UniqueArrayWrapper(e,t){this.parent=e,this.each=getEachForSource(e.source),this.keyFn=createCallback(t)}function getEachForSource(e){return e.length<40?UniqueArrayWrapper.prototype.eachNoCache:e.length<100?UniqueArrayWrapper.prototype.eachArrayCache:UniqueSequence.prototype.each}function ConcatArrayWrapper(e,t){this.source=e,this.other=t}function ObjectLikeSequence(){}function AssignSequence(e,t){this.parent=e,this.other=t}function DefaultsSequence(e,t){this.parent=e,this.defaults=t}function InvertedSequence(e){this.parent=e}function PickSequence(e,t){this.parent=e,this.properties=t}function OmitSequence(e,t){this.parent=e,this.properties=t}function ObjectWrapper(e){this.source=e}function StringLikeSequence(){}function StringMatchSequence(e,t){this.source=e,this.pattern=t}function SplitStringSequence(e,t){this.source=e,this.pattern=t}function StringWrapper(e){this.source=e}function GeneratedSequence(e,t){this.get=e,this.fixedLength=t}function GeneratedIterator(e){this.sequence=e,this.index=0,this.currentValue=null}function AsyncSequence(e,t){if(e instanceof AsyncSequence)throw"Sequence is already asynchronous!";this.parent=e,this.onNextCallback=getOnNextCallback(t),this.cancelCallback=getCancelCallback()}function getOnNextCallback(e){return"undefined"==typeof e&&"function"==typeof context.setImmediate?context.setImmediate:(e=e||0,function(t){return setTimeout(t,e)})}function getCancelCallback(e){return"undefined"==typeof e&&"function"==typeof context.clearImmediate?context.clearImmediate:context.clearTimeout}function StreamLikeSequence(){}function LinesSequence(e){this.parent=e}function StreamingHttpSequence(e){this.url=e}function createCallback(e){switch(typeof e){case"function":return e;case"string":return function(t){return t[e]};case"object":return function(t){return Lazy(e).all(function(e,n){return t[n]===e})};case"undefined":return function(e){return e};default:throw"Don't know how to make a callback from a "+typeof e+"!"}}function createSet(e){var t=new Set;return Lazy(e||[]).flatten().each(function(e){t.add(e)}),t}function compare(e,t,n){return"function"==typeof n?compare(n(e),n(t)):e===t?0:e>t?1:-1}function forEach(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n])===!1)return!1;return!0}function recursiveForEach(e,t,n){n=n||[0];for(var r=-1;++r<e.length;)if(e[r]instanceof Array){if(recursiveForEach(e[r],t,n)===!1)return!1}else if(t(e[r],n[0]++)===!1)return!1;return!0}function getFirst(e){var t;return e.each(function(e){return t=e,!1}),t}function contains(e,t){for(var n=-1,r=e.length;++n<r;)if(e[n]===t)return!0;return!1}function containsBefore(e,t,n,r){r=r||function(e){return e};for(var i=-1;++i<n;)if(r(e[i])===r(t))return!0;return!1}function swap(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function indent(e){return new Array(e).join("  ")}function Set(){this.table={}}Sequence.define=function(e,t){if(!t||!t.getIterator&&!t.each)throw"A custom sequence must implement *at least* getIterator or each!";var n=t.init,r=n?function(){this.parent=arguments[0],n.apply(this,arguments)}:function(){this.parent=arguments[0]};r.prototype=new Sequence,delete t.init;for(var i in t)r.prototype[i]=t[i];for(var o="string"==typeof e?[e]:e,c=0;c<o.length;++c)switch(n&&n.length||0){case 0:Sequence.prototype[o[c]]=function(){return new r(this)};break;case 1:Sequence.prototype[o[c]]=function(e){return new r(this,e)};break;case 2:Sequence.prototype[o[c]]=function(e,t){return new r(this,e,t)};break;case 3:Sequence.prototype[o[c]]=function(e,t,n){return new r(this,e,t,n)};break;default:throw"Really need more than three arguments? https://github.com/dtao/lazy.js/issues/new"}return r},Sequence.prototype.toArray=function(){var e=[];return this.each(function(t){e.push(t)}),e},Sequence.prototype.toObject=function(){var e={};return this.each(function(t){e[t[0]]=t[1]}),e},Sequence.prototype.each=function(e){for(var t=this.getIterator(),n=-1;t.moveNext();)if(e(t.current(),++n)===!1)return!1;return!0},Sequence.prototype.forEach=function(e){return this.each(e)},Sequence.prototype.map=function(e){return"string"==typeof e?this.pluck(e):new MappedSequence(this,e)},Sequence.prototype.collect=Sequence.prototype.map,Sequence.prototype.pluck=function(e){return this.map(function(t){return t[e]})},Sequence.prototype.invoke=function(e){return this.map(function(t){return t[e]()})},Sequence.prototype.select=function(e){return new FilteredSequence(this,createCallback(e))},Sequence.prototype.filter=Sequence.prototype.select,Sequence.prototype.reject=function(e){return this.filter(function(t){return!e(t)})},Sequence.prototype.where=function(e){return this.filter(function(t){for(var n in e)if(t[n]!==e[n])return!1;return!0})};var ReversedSequence=Sequence.define("reverse",{each:function(e){for(var t=this.parent.toArray(),n=t.length;--n>=0&&e(t[n])!==!1;);}});Sequence.prototype.concat=function(){return new ConcatenatedSequence(this,Array.prototype.slice.call(arguments,0))},Sequence.prototype.first=function(e){return"undefined"==typeof e?getFirst(this):new TakeSequence(this,e)},Sequence.prototype.head=Sequence.prototype.first,Sequence.prototype.take=Sequence.prototype.first,Sequence.prototype.takeWhile=function(e){return new TakeWhileSequence(this,e)},Sequence.prototype.initial=function(e){return"undefined"==typeof e&&(e=1),this.take(this.length()-e)},Sequence.prototype.last=function(e){return"undefined"==typeof e?this.reverse().first():this.reverse().take(e).reverse()},Sequence.prototype.findWhere=function(e){return this.where(e).first()};var DropSequence=Sequence.define(["drop","skip","tail","rest"],{init:function(e,t){this.count="number"==typeof t?t:1},each:function(e){var t=this,n=0;t.parent.each(function(r){return n++<t.count?void 0:e(r)})}});Sequence.prototype.dropWhile=Sequence.prototype.skipWhile=function(e){return new DropWhileSequence(this,e)},Sequence.prototype.sortBy=function(e){return new SortedSequence(this,e)},Sequence.prototype.groupBy=function(e){return new GroupedSequence(this,e)},Sequence.prototype.countBy=function(e){return new CountedSequence(this,e)},Sequence.prototype.uniq=function(e){return new UniqueSequence(this,createCallback(e))},Sequence.prototype.unique=Sequence.prototype.uniq,Sequence.prototype.zip=function(e){return 1===arguments.length?new SimpleZippedSequence(this,e):new ZippedSequence(this,Array.prototype.slice.call(arguments,0))},Sequence.prototype.shuffle=function(){return new ShuffledSequence(this)},Sequence.prototype.flatten=function(){return new FlattenedSequence(this)},Sequence.prototype.compact=function(){return this.filter(function(e){return!!e})},Sequence.prototype.without=function(){return new WithoutSequence(this,Array.prototype.slice.call(arguments,0))},Sequence.prototype.difference=Sequence.prototype.without,Sequence.prototype.union=function(e){return this.concat(e).uniq()},Sequence.prototype.intersection=function(e){return 1===arguments.length&&arguments[0]instanceof Array?new SimpleIntersectionSequence(this,e):new IntersectionSequence(this,Array.prototype.slice.call(arguments,0))},Sequence.prototype.every=function(e){var t=!0;return this.each(function(n,r){return e(n,r)?void 0:(t=!1,!1)}),t},Sequence.prototype.all=Sequence.prototype.every,Sequence.prototype.some=function(e){e||(e=function(){return!0});var t=!1;return this.each(function(n){return e(n)?(t=!0,!1):void 0}),t},Sequence.prototype.any=Sequence.prototype.some,Sequence.prototype.isEmpty=function(){return!this.any()},Sequence.prototype.indexOf=function(e){var t=0,n=-1;return this.each(function(r){return r===e?(n=t,!1):(++t,void 0)}),n},Sequence.prototype.lastIndexOf=function(e){var t=this.reverse().indexOf(e);return-1!==t&&(t=this.length()-t-1),t},Sequence.prototype.sortedIndex=function(e){for(var t,n=0,r=this.length();r>n;)t=n+r>>>1,-1===compare(this.get(t),e)?n=t+1:r=t;return n},Sequence.prototype.contains=function(e){return-1!==this.indexOf(e)},Sequence.prototype.reduce=function(e,t){return arguments.length<2?this.tail().reduce(e,this.head()):(this.each(function(n,r){t=e(t,n,r)}),t)},Sequence.prototype.inject=Sequence.prototype.reduce,Sequence.prototype.foldl=Sequence.prototype.reduce,Sequence.prototype.reduceRight=function(e,t){if(arguments.length<2)return this.initial(1).reduceRight(e,this.last());var n=this.length()-1;return this.reverse().reduce(function(t,r){return e(t,r,n--)},t)},Sequence.prototype.foldr=Sequence.prototype.reduceRight,Sequence.prototype.find=function(e){return this.filter(e).first()},Sequence.prototype.detect=Sequence.prototype.find,Sequence.prototype.min=function(e){var t,n=1/0;return"undefined"!=typeof e?(e=createCallback(e),this.each(function(r){var i=e(r);n>i&&(n=i,t=r)}),t):(this.each(function(e){n>e&&(n=e)}),n)},Sequence.prototype.max=function(e){var t,n=-1/0;return"undefined"!=typeof e?(e=createCallback(e),this.each(function(r){var i=e(r);i>n&&(n=i,t=r)}),t):(this.each(function(e){e>n&&(n=e)}),n)},Sequence.prototype.sum=function(e){return"undefined"!=typeof e?(e=createCallback(e),this.reduce(function(t,n){return t+=e(n)},0)):this.reduce(function(e,t){return e+=t},0)},Sequence.prototype.join=function(e){e="string"==typeof e?e:",";var t="";return this.each(function(n){t.length>0&&(t+=e),t+=n}),t},Sequence.prototype.toString=Sequence.prototype.join,Sequence.prototype.async=function(e){return new AsyncSequence(this,e)},MappedSequence.prototype=new Sequence,MappedSequence.prototype.each=function(e){var t=this.mapFn;return this.parent.each(function(n,r){return e(t(n,r),r)})},CachingSequence.prototype=new Sequence,CachingSequence.inherit=function(e){return e.prototype=new CachingSequence,e},CachingSequence.prototype.cache=function(){return this.cached||(this.cached=this.toArray()),this.cached},CachingSequence.prototype.get=function(e){return this.cache()[e]},CachingSequence.prototype.length=function(){return this.cache().length},CachingSequence.prototype.getIterator=function(){return Lazy(this.cache()).getIterator()},FilteredSequence.prototype=new Sequence,FilteredSequence.prototype.getIterator=function(){return new FilteringIterator(this.parent,this.filterFn)},FilteredSequence.prototype.each=function(e){var t=this.filterFn;return this.parent.each(function(n,r){return t(n,r)?e(n,r):void 0})},ConcatenatedSequence.prototype=new Sequence,ConcatenatedSequence.prototype.each=function(e){var t=!1,n=0;this.parent.each(function(r){return e(r,n++)===!1?(t=!0,!1):void 0}),t||Lazy(this.arrays).flatten().each(function(t){return e(t,n++)===!1?!1:void 0})};var TakeSequence=CachingSequence.inherit(function(e,t){this.parent=e,this.count=t});TakeSequence.prototype.each=function(e){var t=this,n=0;t.parent.each(function(r){var i;return n<t.count&&(i=e(r,n)),++n>=t.count?!1:i})};var TakeWhileSequence=CachingSequence.inherit(function(e,t){this.parent=e,this.predicate=t});TakeWhileSequence.prototype.each=function(e){var t=this.predicate;this.parent.each(function(n){return t(n)&&e(n)})};var DropWhileSequence=CachingSequence.inherit(function(e,t){this.parent=e,this.predicate=t});DropWhileSequence.prototype.each=function(e){var t=this.predicate,n=!1;this.parent.each(function(r){if(!n){if(t(r))return;n=!0}return e(r)})};var SortedSequence=CachingSequence.inherit(function(e,t){this.parent=e,this.sortFn=t});SortedSequence.prototype.each=function(e){var t=this.sortFn,n=this.parent.toArray(),r=-1;for(n.sort(function(e,n){return compare(e,n,t)});++r<n.length&&e(n[r],r)!==!1;);};var ShuffledSequence=CachingSequence.inherit(function(e){this.parent=e});ShuffledSequence.prototype.each=function(e){for(var t=this.parent.toArray(),n=Math.floor,r=Math.random,i=0,o=t.length-1;o>0;--o)if(swap(t,o,n(r()*o)+1),e(t[o],i++)===!1)return;e(t[0],i)};var GroupedSequence=CachingSequence.inherit(function(e,t){t=createCallback(t),this.each=function(n){var r={};e.each(function(e){var n=t(e);r[n]?r[n].push(e):r[n]=[e]});for(var i in r)if(n([i,r[i]])===!1)break}}),CountedSequence=CachingSequence.inherit(function(e,t){t=createCallback(t),this.each=function(n){var r={};e.each(function(e){var n=t(e);r[n]?r[n]+=1:r[n]=1});for(var i in r)n([i,r[i]])}}),UniqueSequence=CachingSequence.inherit(function(e,t){this.parent=e,this.keyFn=t});UniqueSequence.prototype.each=function(e){var t=new Set,n=this.keyFn,r=0;this.parent.each(function(i){return t.add(n(i))?e(i,r++):void 0})};var FlattenedSequence=CachingSequence.inherit(function(e){this.parent=e});FlattenedSequence.prototype.each=function(e){var t=0,n=!1,r=function(i){return n?!1:i instanceof Sequence?(i.each(function(e){return r(e)===!1?(n=!0,!1):void 0}),void 0):i instanceof Array?forEach(i,r):e(i,t++)};this.parent.each(r)};var WithoutSequence=CachingSequence.inherit(function(e,t){this.parent=e,this.values=t});WithoutSequence.prototype.each=function(e){var t=createSet(this.values),n=0;this.parent.each(function(r){return t.contains(r)?void 0:e(r,n++)})},SimpleIntersectionSequence.prototype=new Sequence,SimpleIntersectionSequence.prototype.eachMemoizerCache=function(e){var t=new UniqueMemoizer(Lazy(this.array).getIterator()),n=0;this.parent.each(function(r){return t.contains(r)?e(r,n++):void 0})},SimpleIntersectionSequence.prototype.eachArrayCache=function(e){var t=this.array,n=contains,r=0;this.parent.each(function(i){return n(t,i)?e(i,r++):void 0})};var IntersectionSequence=CachingSequence.inherit(function(e,t){this.parent=e,this.arrays=t});IntersectionSequence.prototype.each=function(e){var t=Lazy(this.arrays).map(function(e){return new UniqueMemoizer(Lazy(e).getIterator())}),n=new UniqueMemoizer(t.getIterator()),r=0;this.parent.each(function(t){var i=!0;return n.each(function(e){return e.contains(t)?void 0:(i=!1,!1)}),i?e(t,r++):void 0})},SimpleZippedSequence.prototype=new Sequence,SimpleZippedSequence.prototype.each=function(e){var t=this.array;this.parent.each(function(n,r){return e([n,t[r]],r)})};var ZippedSequence=CachingSequence.inherit(function(e,t){this.parent=e,this.arrays=t});ZippedSequence.prototype.each=function(e){var t=this.arrays,n=0;this.parent.each(function(r){for(var i=[r],o=0;o<t.length;++o)t[o].length>n&&i.push(t[o][n]);return e(i,n++)})},Iterator.prototype.current=function(){return this.sequence.get(this.index)},Iterator.prototype.moveNext=function(){return this.index>=this.sequence.length()-1?!1:(++this.index,!0)},FilteringIterator.prototype.current=function(){return this.value},FilteringIterator.prototype.moveNext=function(){for(var e,t=this.iterator,n=this.filterFn;t.moveNext();)if(e=t.current(),n(e))return this.value=e,!0;return this.value=void 0,!1},CharIterator.prototype=new Iterator,CharIterator.prototype.current=function(){return this.source.charAt(this.index)},CharIterator.prototype.moveNext=function(){return++this.index<this.source.length},StringMatchIterator.prototype.current=function(){return this.match[0]},StringMatchIterator.prototype.moveNext=function(){return!!(this.match=this.pattern.exec(this.source))},SplitWithRegExpIterator.prototype.current=function(){return this.source.substring(this.start,this.end)},SplitWithRegExpIterator.prototype.moveNext=function(){if(!this.pattern)return!1;var e=this.pattern.exec(this.source);return e?(this.start=this.nextStart?this.nextStart:0,this.end=e.index,this.nextStart=e.index+e[0].length,!0):this.pattern?(this.start=this.nextStart,this.end=void 0,this.nextStart=void 0,this.pattern=void 0,!0):!1},SplitWithStringIterator.prototype.current=function(){return this.source.substring(this.leftIndex,this.rightIndex)},SplitWithStringIterator.prototype.moveNext=function(){return this.finished||(this.leftIndex="undefined"!=typeof this.leftIndex?this.rightIndex+this.delimiter.length:0,this.rightIndex=this.source.indexOf(this.delimiter,this.leftIndex)),-1===this.rightIndex?(this.finished=!0,this.rightIndex=void 0,!0):!this.finished},UniqueMemoizer.prototype=new Iterator,UniqueMemoizer.prototype.current=function(){return this.currentValue},UniqueMemoizer.prototype.moveNext=function(){for(var e,t=this.iterator,n=this.set,r=this.memo;t.moveNext();)if(e=t.current(),n.add(e))return r.push(e),this.currentValue=e,!0;return!1},UniqueMemoizer.prototype.each=function(e){for(var t=this.memo,n=t.length,r=-1;++r<n;)if(e(t[r],r)===!1)return!1;for(;this.moveNext()&&e(this.currentValue,r++)!==!1;);},UniqueMemoizer.prototype.contains=function(e){if(this.set.contains(e))return!0;for(;this.moveNext();)if(this.currentValue===e)return!0;return!1},ArrayLikeSequence.prototype=new Sequence,ArrayLikeSequence.define=function(e,t){var n=t?function(){this.parent=arguments[0],t.apply(this,arguments)}:function(){this.parent=arguments[0]};return n.prototype=new ArrayLikeSequence,ArrayLikeSequence.prototype[e]=function(e,t,r){return new n(this,e,t,r)},n},ArrayLikeSequence.prototype.get=function(e){return this.parent.get(e)},ArrayLikeSequence.prototype.length=function(){return this.parent.length()},ArrayLikeSequence.prototype.getIterator=function(){return new Iterator(this)},ArrayLikeSequence.prototype.each=function(e){for(var t=this.length(),n=-1;++n<t&&e(this.get(n),n)!==!1;);},ArrayLikeSequence.prototype.map=function(e){return"string"==typeof e?this.pluck(e):new IndexedMappedSequence(this,e)},ArrayLikeSequence.prototype.collect=ArrayLikeSequence.prototype.map,ArrayLikeSequence.prototype.select=function(e){return new IndexedFilteredSequence(this,createCallback(e))},ArrayLikeSequence.prototype.filter=ArrayLikeSequence.prototype.select,ArrayLikeSequence.prototype.reverse=function(){return new IndexedReversedSequence(this)},ArrayLikeSequence.prototype.first=function(e){return"undefined"==typeof e?this.get(0):new IndexedTakeSequence(this,e)},ArrayLikeSequence.prototype.head=ArrayLikeSequence.prototype.take=ArrayLikeSequence.prototype.first,ArrayLikeSequence.prototype.rest=function(e){return new IndexedDropSequence(this,e)},ArrayLikeSequence.prototype.tail=ArrayLikeSequence.prototype.drop=ArrayLikeSequence.prototype.rest,ArrayLikeSequence.prototype.concat=function(e){return 1===arguments.length&&arguments[0]instanceof Array?new IndexedConcatenatedSequence(this,e):Sequence.prototype.concat.apply(this,arguments)},ArrayLikeSequence.prototype.uniq=function(e){return new IndexedUniqueSequence(this,createCallback(e))},IndexedMappedSequence.prototype=new ArrayLikeSequence,IndexedMappedSequence.prototype.get=function(e){return 0>e||e>=this.parent.length()?void 0:this.mapFn(this.parent.get(e),e)},IndexedFilteredSequence.prototype=new FilteredSequence,IndexedFilteredSequence.prototype.each=function(e){for(var t,n=this.parent,r=this.filterFn,i=this.parent.length(),o=-1;++o<i&&(t=n.get(o),!r(t,o)||e(t,o)!==!1););},IndexedReversedSequence.prototype=new ArrayLikeSequence,IndexedReversedSequence.prototype.get=function(e){return this.parent.get(this.length()-e-1)},IndexedTakeSequence.prototype=new ArrayLikeSequence,IndexedTakeSequence.prototype.length=function(){var e=this.parent.length();return this.count<=e?this.count:e},IndexedDropSequence.prototype=new ArrayLikeSequence,IndexedDropSequence.prototype.get=function(e){return this.parent.get(this.count+e)},IndexedDropSequence.prototype.length=function(){var e=this.parent.length();return this.count<=e?e-this.count:0},IndexedConcatenatedSequence.prototype=new ArrayLikeSequence,IndexedConcatenatedSequence.prototype.get=function(e){var t=this.parent.length();return t>e?this.parent.get(e):this.other[e-t]},IndexedConcatenatedSequence.prototype.length=function(){return this.parent.length()+this.other.length},IndexedUniqueSequence.prototype=new Sequence,IndexedUniqueSequence.prototype.eachArrayCache=function(e){for(var t,n,r=this.parent,i=this.keyFn,o=r.length(),c=[],u=contains,a=-1,p=0;++a<o;)if(n=r.get(a),t=i(n),!u(c,t)&&(c.push(t),e(n,p++)===!1))return!1},IndexedUniqueSequence.prototype.eachSetCache=UniqueSequence.prototype.each,ArrayWrapper.prototype=new ArrayLikeSequence,ArrayWrapper.prototype.get=function(e){return this.source[e]},ArrayWrapper.prototype.length=function(){return this.source.length},ArrayWrapper.prototype.each=function(e){for(var t=this.source,n=t.length,r=-1;++r<n&&e(t[r],r)!==!1;);},ArrayWrapper.prototype.map=ArrayWrapper.prototype.collect=function(e){return"string"==typeof e?this.pluck(e):new MappedArrayWrapper(this.source,e)},ArrayWrapper.prototype.filter=ArrayWrapper.prototype.select=function(e){return new FilteredArrayWrapper(this,createCallback(e))},ArrayWrapper.prototype.uniq=ArrayWrapper.prototype.unique=function(e){return new UniqueArrayWrapper(this,createCallback(e))},ArrayWrapper.prototype.concat=function(e){return 1===arguments.length&&arguments[0]instanceof Array?new ConcatArrayWrapper(this.source,e):ArrayLikeSequence.prototype.concat.apply(this,arguments)},ArrayWrapper.prototype.toArray=function(){return this.source.slice(0)},MappedArrayWrapper.prototype=new ArrayLikeSequence,MappedArrayWrapper.prototype.get=function(e){return 0>e||e>=this.source.length?void 0:this.mapFn(this.source[e])},MappedArrayWrapper.prototype.length=function(){return this.source.length},MappedArrayWrapper.prototype.each=function(e){for(var t=this.source,n=this.source.length,r=this.mapFn,i=-1;++i<n;)if(e(r(t[i],i),i)===!1)return},FilteredArrayWrapper.prototype=new FilteredSequence,FilteredArrayWrapper.prototype.each=function(e){for(var t,n=this.parent.source,r=this.filterFn,i=n.length,o=-1;++o<i&&(t=n[o],!r(t,o)||e(t,o)!==!1););},UniqueArrayWrapper.prototype=new CachingSequence,UniqueArrayWrapper.prototype.eachNoCache=function(e){for(var t,n=this.parent.source,r=this.keyFn,i=n.length,o=containsBefore,c=-1,u=0;++c<i;)if(t=n[c],!o(n,t,c,r)&&e(t,u++)===!1)return!1},UniqueArrayWrapper.prototype.eachArrayCache=function(e){for(var t,n,r=this.parent.source,i=this.keyFn,o=r.length,c=[],u=contains,a=-1,p=0;++a<o;)if(n=r[a],t=i(n),!u(c,t)&&(c.push(t),e(n,p++)===!1))return!1},UniqueArrayWrapper.prototype.eachSetCache=UniqueSequence.prototype.each,ConcatArrayWrapper.prototype=new ArrayLikeSequence,ConcatArrayWrapper.prototype.get=function(e){var t=this.source.length;return t>e?this.source[e]:this.other[e-t]},ConcatArrayWrapper.prototype.length=function(){return this.source.length+this.other.length},ConcatArrayWrapper.prototype.each=function(e){for(var t=this.source,n=t.length,r=this.other,i=r.length,o=0,c=-1;++c<n;)if(e(t[c],o++)===!1)return!1;for(c=-1;++c<i;)if(e(r[c],o++)===!1)return!1},ObjectLikeSequence.prototype=new Sequence,ObjectLikeSequence.prototype.get=function(e){return this.parent.get(e)},ObjectLikeSequence.prototype.keys=function(){return this.map(function(e,t){return t})},ObjectLikeSequence.prototype.values=function(){return this.map(function(e){return e})},ObjectLikeSequence.prototype.assign=function(e){return new AssignSequence(this,e)},ObjectLikeSequence.prototype.extend=ObjectLikeSequence.prototype.assign,ObjectLikeSequence.prototype.defaults=function(e){return new DefaultsSequence(this,e)},ObjectLikeSequence.prototype.invert=function(){return new InvertedSequence(this)},ObjectLikeSequence.prototype.functions=function(){return this.filter(function(e){return"function"==typeof e}).map(function(e,t){return t})},ObjectLikeSequence.prototype.methods=ObjectLikeSequence.prototype.functions,ObjectLikeSequence.prototype.pick=function(e){return new PickSequence(this,e)},ObjectLikeSequence.prototype.omit=function(e){return new OmitSequence(this,e)},ObjectLikeSequence.prototype.toArray=function(){return this.map(function(e,t){return[t,e]}).toArray()},ObjectLikeSequence.prototype.pairs=ObjectLikeSequence.prototype.toArray,ObjectLikeSequence.prototype.toObject=function(){return this.map(function(e,t){return[t,e]}).toObject()},AssignSequence.prototype=new ObjectLikeSequence,AssignSequence.prototype.each=function(e){var t=new Set,n=!1;Lazy(this.other).each(function(r,i){return e(r,i)===!1?(n=!0,!1):(t.add(i),void 0)}),n||this.parent.each(function(n,r){return t.contains(r)||e(n,r)!==!1?void 0:!1})},DefaultsSequence.prototype=new ObjectLikeSequence,DefaultsSequence.prototype.each=function(e){var t=new Set,n=!1;this.parent.each(function(r,i){return e(r,i)===!1?(n=!0,!1):("undefined"!=typeof r&&t.add(i),void 0)}),n||Lazy(this.defaults).each(function(n,r){return t.contains(r)||e(n,r)!==!1?void 0:!1})},InvertedSequence.prototype=new ObjectLikeSequence,InvertedSequence.prototype.each=function(e){this.parent.each(function(t,n){return e(n,t)})},PickSequence.prototype=new ObjectLikeSequence,PickSequence.prototype.each=function(e){var t=contains,n=this.properties;this.parent.each(function(r,i){return t(n,i)?e(r,i):void 0})},OmitSequence.prototype=new ObjectLikeSequence,OmitSequence.prototype.each=function(e){var t=contains,n=this.properties;this.parent.each(function(r,i){return t(n,i)?void 0:e(r,i)})},ObjectWrapper.prototype=new ObjectLikeSequence,ObjectWrapper.prototype.get=function(e){return this.source[e]},ObjectWrapper.prototype.each=function(e){var t,n=this.source;for(t in n)if(e(n[t],t)===!1)return},StringLikeSequence.prototype=new ArrayLikeSequence,StringLikeSequence.prototype.getIterator=function(){return new CharIterator(this.source)},StringLikeSequence.prototype.charAt=function(e){return this.get(e)},StringLikeSequence.prototype.each=function(e){for(var t=this.source,n=t.length,r=-1;++r<n&&e(t.charAt(r))!==!1;);},StringLikeSequence.prototype.match=function(e){return new StringMatchSequence(this.source,e)},StringLikeSequence.prototype.split=function(e){return new SplitStringSequence(this.source,e)},StringMatchSequence.prototype=new Sequence,StringMatchSequence.prototype.each=function(e){for(var t=this.getIterator();t.moveNext();)if(e(t.current())===!1)return},StringMatchSequence.prototype.getIterator=function(){return new StringMatchIterator(this.source,this.pattern)},SplitStringSequence.prototype=new Sequence,SplitStringSequence.prototype.each=function(e){for(var t=this.getIterator();t.moveNext()&&e(t.current())!==!1;);},SplitStringSequence.prototype.getIterator=function(){return this.pattern instanceof RegExp?""===this.pattern.source||"(?:)"===this.pattern.source?new CharIterator(this.source):new SplitWithRegExpIterator(this.source,this.pattern):""===this.pattern?new CharIterator(this.source):new SplitWithStringIterator(this.source,this.pattern)},StringWrapper.prototype=new StringLikeSequence,StringWrapper.prototype.get=function(e){return this.source.charAt(e)},StringWrapper.prototype.length=function(){return this.source.length},GeneratedSequence.prototype=new Sequence,GeneratedSequence.prototype.length=function(){return this.fixedLength},GeneratedSequence.prototype.each=function(e){for(var t=this.get,n=this.fixedLength,r=0;("undefined"==typeof n||n>r)&&e(t(r++))!==!1;);},GeneratedSequence.prototype.getIterator=function(){return new GeneratedIterator(this)},GeneratedIterator.prototype.current=function(){return this.currentValue},GeneratedIterator.prototype.moveNext=function(){var e=this.sequence;return"number"==typeof e.fixedLength&&this.index>=e.fixedLength?!1:(this.currentValue=e.get(this.index++),!0)},AsyncSequence.prototype=new Sequence,AsyncSequence.prototype.each=function(e){var t=this.parent.getIterator(),n=this.onNextCallback,r=this.cancelCallback,i={id:null,cancel:function(){i.id&&(r(i.id),i.id=null)},onError:function(e){i.errorCallback=e},errorCallback:function(){}};return t.moveNext()&&(i.id=n(function o(){try{e(t.current())!==!1&&t.moveNext()&&(i.id=n(o))}catch(r){i.errorCallback(r)}})),i},StreamLikeSequence.prototype=new Sequence,StreamLikeSequence.prototype.lines=function(){return new LinesSequence(this)},LinesSequence.prototype=new Sequence,LinesSequence.prototype.each=function(e){var t=!1;this.parent.each(function(n){return Lazy(n).split("\n").each(function(n){return e(n)===!1?(t=!0,!1):void 0}),!t})},StreamingHttpSequence.prototype=new StreamLikeSequence,StreamingHttpSequence.prototype.each=function(e){var t=new XMLHttpRequest,n=0,r=!1;t.open("GET",this.url);var i=function(o){r||(o=t.responseText.substring(n),e(o)===!1&&(t.removeEventListener("progress",i,!1),t.abort(),r=!0),n+=o.length)};t.addEventListener("progress",i,!1),t.send()};var Lazy=function(e){return e instanceof Array?new ArrayWrapper(e):"string"==typeof e?new StringWrapper(e):e instanceof Sequence?e:new ObjectWrapper(e)};Lazy.generate=function(e,t){return new GeneratedSequence(e,t)},Lazy.range=function(){var e=arguments.length>1?arguments[0]:0,t=arguments.length>1?arguments[1]:arguments[0],n=arguments.length>2?arguments[2]:1;return this.generate(function(t){return e+n*t}).take(Math.floor((t-e)/n))},Lazy.repeat=function(e,t){return Lazy.generate(function(){return e},t)},Lazy.Sequence=Sequence,Lazy.ArrayLikeSequence=ArrayLikeSequence,Lazy.ObjectLikeSequence=ObjectLikeSequence,Lazy.StringLikeSequence=StringLikeSequence,Lazy.GeneratedSequence=GeneratedSequence,Lazy.AsyncSequence=AsyncSequence,Lazy.noop=function(){},Lazy.identity=function(e){return e},Set.prototype.add=function(e){var t,n,r=this.table,i=typeof e;switch(i){case"number":case"boolean":case"undefined":return r[e]?!1:(r[e]=!0,!0);case"string":return t=e.charAt(0),("_ftc@".indexOf(t)>=0||t>="0"&&"9">=t)&&(e="@"+e),r[e]?!1:(r[e]=!0,!0);default:return n=this.objects,n||(n=this.objects=[]),contains(n,e)?!1:(n.push(e),!0)}},Set.prototype.contains=function(e){var t,n=typeof e;switch(n){case"number":case"boolean":case"undefined":return!!this.table[e];case"string":return t=e.charAt(0),("_ftc@".indexOf(t)>=0||t>="0"&&"9">=t)&&(e="@"+e),!!this.table[e];default:return this.objects&&contains(this.objects,e)}},"object"==typeof module?module.exports=Lazy:context.Lazy=Lazy}("undefined"!=typeof global?global:this);