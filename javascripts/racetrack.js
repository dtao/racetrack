function getChartOptions(){var e=document.querySelector('input[name="title"]').value;return{title:{text:e},plotOptions:{series:{animation:!1}}}}var lodash=_.noConflict();window.addEventListener("load",function(){function createEditor(e){var t=document.getElementById(e),r=t.querySelector("textarea");return CodeMirror.fromTextArea(r,{mode:"javascript",lineNumbers:!0})}function displayError(e){var t=document.createElement("P");t.textContent=e,errors.appendChild(t)}function addBenchmarkToSuite(e,t,r,n){n=n||function(e){return e};var a=_.template(benchmarkTemplate,{name:e,setup:setupEditor.getValue(),code:n(t.getValue()),inputSize:r});return a}function formatNumber(e){for(var t=e.toFixed(3).split("."),r=t[0],n=t[1],a=[];r.length>=3;)a.unshift(r.substring(r.length-3)),r=r.substring(0,r.length-3);return r.length>0&&a.unshift(r),a.join(",")+"."+n}function parseNumber(e){return Number(String(e).replace(/,/g,""))}function getRowData(e){return e?{name:e.children[0].textContent,results:Lazy(e.querySelectorAll("td:not(:first-child)")).map(function(e){return{inputSize:e.getAttribute("data-input-size"),hz:parseNumber(e.textContent)}}).toArray()}:null}function setLastCellValue(e,t){e.querySelector("td:last-child").textContent=t}function loadSavedBenchmarks(){return JSON.parse(localStorage.benchmarks||"[]")}function saveBenchmarks(e,t){localStorage.benchmarks=JSON.stringify(e),populateBenchmarksList(e),t&&highlightBenchmark(t)}function deleteBenchmark(e){e=Number(e);var t=loadSavedBenchmarks();t.splice(e,1),saveBenchmarks(t)}function populateBenchmarksList(e){benchmarksList.innerHTML="",Lazy(e).each(function(e,t){var r=document.createElement("A");r.setAttribute("href","javascript:void(0);"),r.setAttribute("data-benchmark",t);var n=document.createElement("SPAN");n.className="delete",r.appendChild(n);var a=document.createElement("SPAN");a.className="title",a.textContent=e.title,r.appendChild(a);var s=document.createElement("SMALL");s.textContent=new Date(e.created).toLocaleString(),r.appendChild(s),benchmarksList.appendChild(r)})}function highlightBenchmark(e){var t=Lazy(benchmarksList.children).find(function(t){return t.querySelector(".title").textContent===e});t&&(t.className="highlighted",t.scrollIntoView(),setTimeout(function(){t.removeAttribute("class")},1e3))}function resetResultsTable(){for(var e=results.parentNode.firstElementChild.firstElementChild,t=e.children.length-1;t>=1;--t)e.removeChild(e.children[t])}function addInputSizeColumn(e){var t=results.parentNode.firstElementChild.firstElementChild,r=document.createElement("TH");r.textContent="Ops/sec (N="+e+")",t.appendChild(r)}function addResultsRow(e){var t=document.createElement("TR");t.setAttribute("data-benchmark",e.name),results.appendChild(t);var r=document.createElement("TD");return r.textContent=e.name,t.appendChild(r),Lazy(e.results).each(function(e){var r=document.createElement("TD");r.setAttribute("data-input-size",e.inputSize),r.textContent=formatNumber(e.hz),t.appendChild(r)}),t}function addOrUpdateResultsRow(e,t){var r=results.querySelector('tr[data-benchmark="'+e.name+'"]');if(!r){r=document.createElement("TR"),r.setAttribute("data-benchmark",e.name);var n=document.createElement("TD");n.textContent=e.name,r.appendChild(n),Lazy(t).each(function(e){var t=document.createElement("TD");t.setAttribute("data-input-size",e),r.appendChild(t)}),results.appendChild(r)}var a=r.querySelector('td[data-input-size="'+e.inputSize+'"]');return a.textContent=formatNumber(e.hz),r}function runBenchmarks(){var suite=new Benchmark.Suite;results.innerHTML="",progress.innerHTML="",chart.innerHTML="",resetResultsTable();var sizes=inputSizes.value.split(/,\s*/);Lazy(sizes).each(function(inputSize){addInputSizeColumn(inputSize),eval(addBenchmarkToSuite("Underscore",underscoreEditor,inputSize)),eval(addBenchmarkToSuite("Lo-Dash",underscoreEditor,inputSize,function(e){return e.replace(/\b_\b/g,"lodash")})),eval(addBenchmarkToSuite("Lazy.js",lazyEditor,inputSize))});var cycles={},topCycles=0,resultCount=0;suite.forEach(function(e){e.on("cycle",function(){var t=e.name+" (N="+e.inputSize+")",r=progress.querySelector('.progress-bar[data-benchmark="'+t+'"]');r||(r=document.createElement("DIV"),r.className="progress progress-striped active",progress.appendChild(r),r=r.appendChild(document.createElement("DIV")),r.className="progress-bar",r.setAttribute("data-benchmark",t),r.appendChild(document.createElement("SPAN")));var n=cycles[t]||0;n+=e.count,topCycles=Math.max(topCycles,n),r.querySelector("SPAN").textContent=t+": "+n+" runs",cycles[t]=n,Lazy(progress.querySelectorAll(".progress-bar")).each(function(e){var t=cycles[e.getAttribute("data-benchmark")];e.style.width=Math.floor(100*(t/topCycles))+"%"})}),e.on("error",function(e){displayError(e.message)})}),suite.on("cycle",function(e){var t=e.target,r=progress.querySelector(".progress.active");r&&(r.className="progress"),addOrUpdateResultsRow(t,sizes),++resultCount===3*sizes.length&&(createChartFromTable(),runButton.removeAttribute("disabled"))}),runButton.setAttribute("disabled","disabled"),suite.run({async:!0})}function createChartFromTable(){chart.style.display=null,HighTables.renderCharts(),setTimeout(function(){progress.innerHTML=""},1e3)}Benchmark.options.maxTime=1;var results=document.querySelector("table#results tbody"),progress=document.getElementById("progress"),chart=document.getElementById("chart"),errors=document.getElementById("errors"),title=document.querySelector('input[name="title"]'),inputSizes=document.querySelector('input[name="input-sizes"]'),benchmarksList=document.querySelector(".saved-benchmarks"),setupEditor=createEditor("setup"),lazyEditor=createEditor("lazy"),underscoreEditor=createEditor("underscore"),newButton=document.getElementById("new-benchmark"),runButton=document.getElementById("run-benchmarks"),saveButton=document.getElementById("save-benchmarks"),benchmarkTemplate=document.getElementById("benchmark-template").textContent;benchmarksList.addEventListener("click",function(e){var t=e.target;if("SPAN"===t.nodeName&&"delete"===t.className&&confirm("Are you sure you want to delete this benchmark?"))return deleteBenchmark(t.getAttribute("data-benchmark")),void 0;for(;"A"!==t.nodeName;)if(t=t.parentNode,t===document)return;var r=t.getAttribute("data-benchmark"),n=loadSavedBenchmarks()[r];title.value=n.title,inputSizes.value=n.inputSizes||"",setupEditor.setValue(n.setup),lazyEditor.setValue(n.lazy),underscoreEditor.setValue(n.underscore),results.innerHTML="",progress.innerHTML="",chart.innerHTML="",resetResultsTable(),n.lazyResults&&(Lazy(n.lazyResults.results).pluck("inputSize").each(addInputSizeColumn),addResultsRow(n.underscoreResults),addResultsRow(n.lodashResults),addResultsRow(n.lazyResults),createChartFromTable())}),newButton.addEventListener("click",function(){results.innerHTML="",progress.innerHTML="",chart.innerHTML="",title.value="",setupEditor.setValue(""),lazyEditor.setValue(""),underscoreEditor.setValue("")}),runButton.addEventListener("click",function(){runBenchmarks()}),saveButton.addEventListener("click",function(){var e={title:title.value,inputSizes:inputSizes.value,setup:setupEditor.getValue(),lazy:lazyEditor.getValue(),underscore:underscoreEditor.getValue(),underscoreResults:getRowData(results.children[0]),lodashResults:getRowData(results.children[1]),lazyResults:getRowData(results.children[2]),created:(new Date).getTime()},t=loadSavedBenchmarks(),r=Lazy(t).pluck("title").indexOf(e.title);-1!==r?t[r]=Lazy(t[r]).extend(e).toObject():t.push(e),saveBenchmarks(t,e.title)}),window.addEventListener("error",function(e){displayError(e.message)}),populateBenchmarksList(loadSavedBenchmarks())});